﻿<%= render 'layouts/sidebar_sorting' %>
<div id="overview" class="search">
	<% @warning = @resultscount == 0 ? " warning" : "" %>
	  <p class="stdNotice <%= @warning %>"><b><%= @resultscount %></b> Suchergebnis<% if @results.size>1 || @results.size==0%>se<% end %> für &#132;<i><%= params[:search] %>&#147;</i> in <b><%= @cat %></b></p>
<% if @cat != 'User' %>
<% @results.each do |p| %>
    <%
      @owner = p.roles.where(:role => 'owner').first.user
      @jobs = get_open_jobs p

      # singular/plural
      @sinplu = p.roles.count > 1 ? "er" : ""
      @spjobs = @jobs.count != 1 ? "offene Jobs" : "offener Job"
    %>
    <table id="searchresults">
      <tbody>
        <tr>
          <td class="pic"><%= link_to image_tag("user-40.jpg"), p %></td>
          <td class="title"><%= link_to p do %><h6><%= p.title %></h6><% end %><p>am <b><%= fdate p.created_at %></b></p></td>
          <td class="count">
            <% if @cat == 'Projekte' %>
              <span><%= p.roles.count %></span> Teammitglied<%= @sinplu %>, 
              <span><%= p.followers.count %></span> Beobachter<br />
            <% end %>
            <% if @jobs.count > 0 %>
              <span><%= image_tag "jobs.png" %><%= @jobs.count %></span> 
              <b><%= @spjobs %></b>
            <% end %>
            <br />
            <% if @cat == 'Jobs' %>
              <ul>
              <% @jobs.each do |j| %>
                  <li><%= j.name %></li>
              <% end %>
              </ul>
            <% end %>
          </td>
          <td class="follow">
            <%= link_to p, :class=>"stdBtn" do %><p>Ansehen</p><%= image_tag "details-arrow.png" %></a><% end %>
            <%= link_to '', :class=>"stdBtn" do %><p>Beobachten</p><%= image_tag "spec.png" %></a><% end %>
          </td>
        </tr>
      </tbody>
    </table>
<% end else %>
<ul id="resultsuser">
<% 
  @ind = 0
  @results.each do |u| 
%>
  <% @ind = @ind + 1  %>
  <li class="<% if @ind % 5 == 0 %>nomarg<% end %>">
    <div><b><%= u.roles.count %></b> Projekt<% if u.roles.count != 1 %>e<% end %></div>
    <%= link_to image_tag(avatar_url(u, 140)), u, :class=>"pic" %><br />
    <p>
      <%= link_to strim(u.name,15), u, :class=>"name" %><br />
      <%= mail_to u.mail, u.mail, :class=>"mail", :encode => "javascript" %><br /><br />
    </p>
  </li>
<% end %></ul><% end %>
<div class="clean hide"></div>
<%= will_paginate @results %>
</div>